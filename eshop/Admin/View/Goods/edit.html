<layout name="Index/header_foot"/>
<body>
<article class="page-container">
	<form class="form form-horizontal" method="post" id="form-admin-add"  enctype="multipart/form-data">
	<input type="hidden" name="id" value="{$goodsOne['id']}">
	<div id="tabbar-div">
		<p>
			<span class="tab-front" id="general-tab" onclick="charea('general');">通用信息</span>
			<span class="tab-back" id="mix-tab" onclick="charea('mix');">商品属性</span>
			<span class="tab-back" id="level-tab" onclick="charea('level');">会员价格</span>
			<span class="tab-back" id="pic-tab" onclick="charea('pic');">商品相册</span>
		</p>
	</div>
	
	<div id="tabbody-div">
		<div  id="general-table">
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名称：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="text" value="{$goodsOne['goods_name']}"  class="input-text"  name="goods_name">
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">上级分类：</label>
				<div class="formControls col-xs-8 col-sm-9"> 
					<span class="select-box" style="width:150px;">
					<select class="select" name="cat_id" size="1">
						<option value="">请选择...</option>
						<foreach name="catAll" item="val">
						<option value="{$val['id']}" {$goodsOne['cat_id']==$val['id']?'selected':''}>{$val['lv']|str_repeat="--",###}{$val['cat_name']}</option>
						</foreach>
					</select>
					</span>
				 </div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品品牌：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<span class="select-box" style="width:150px;">
					<select class="select" name="brand_id"  size="1">
						<option value="">请选择...</option>
						<foreach name="brandAll" item="val">
						<option value="{$val['id']}"  {$goodsOne['brand_id']==$val['id']?'selected':''}>{$val['brand_name']}</option>
						</foreach>
					</select>
					</span>
				</div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>市场价：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;" value="{$goodsOne['market_price']|intval}" class="input-text"   name="market_price">
				</div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>本店售价：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;" value="{$goodsOne['shop_price']|intval}"  class="input-text"  name="shop_price">
				</div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>赠送积分：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;"  value="{$goodsOne['integral']}" class="input-text"  name="integral" >
				</div>
			</div>
	
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>增加经验值：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;" value="{$goodsOne['exp']}"  class="input-text"  name="exp">
				</div>
			</div>
		
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>积分兑换：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;" value="{$goodsOne['integral_price']}"   class="input-text"  name="integral_price">
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><input type="checkbox" name="is_sale" value="1"  {$goodsOne['is_sale']==1?"checked='1'":''} id="promote" >促销价：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;"  name="promote_price" disabled  class="input-text" value="{$goodsOne['promote_price']}" >
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">促销时间：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="text"  class="input-text" disabled onfocus="WdatePicker({ dateFmt:'yyyy-MM-dd HH:mm:ss',maxDate:'#F<$dp.$D(\'datemax\')||\'%y-%M-%d\'>' })" style="width:250px;" name="promote_start_time"  value="{$goodsOne['promote_start_time']|date='Y-m-d',###}">----<input type="text"  disabled  class="input-text" onfocus="WdatePicker({ dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'#F<$dp.$D(\'datemin\')>' })" style="width:250px;" name="promote_end_time" value="{$goodsOne['promote_end_time']|date='Y-m-d',###}" >
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">logo图片：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="file" name="logo"  />
				</div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">是否热卖：</label>
				<div class="formControls col-xs-8 col-sm-9 skin-minimal">
					<div class="radio-box">
						<input  type="radio"  name="is_hot" {$goodsOne['is_hot']=="1"?'checked':''}   value="1">
						<label for="sex-1">是</label>
					</div>
					<div class="radio-box">
						<input type="radio" {$goodsOne['is_hot']=="0"?'checked':''} name="is_hot"  value="0"  checked>
						<label for="sex-2">否</label>
					</div>
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">是否新品：</label>
				<div class="formControls col-xs-8 col-sm-9 skin-minimal">
					<div class="radio-box">
						<input  type="radio"  name="is_new"  {$goodsOne['is_new']=="1"?'checked':''}   value="1">
						<label for="sex-1">是</label>
					</div>
					<div class="radio-box">
						<input type="radio"  {$goodsOne['is_new']=="0"?'checked':''}  name="is_new" value="0"  checked>
						<label for="sex-2">否</label>
					</div>
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">是否精品：</label>
				<div class="formControls col-xs-8 col-sm-9 skin-minimal">
					<div class="radio-box">
						<input  type="radio" {$goodsOne['is_best']=="1"?'checked':''}  name="is_best"   value="1">
						<label for="sex-1">是</label>
					</div>
					<div class="radio-box">
						<input type="radio" {$goodsOne['is_best']=="0"?'checked':''} name="is_best" value="0"  checked>
						<label for="sex-2">否</label>
					</div>
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">是否上架：</label>
				<div class="formControls col-xs-8 col-sm-9 skin-minimal">
					<div class="radio-box">
						<input  type="radio" {$goodsOne['is_on_sale']==1?'checked':''} name="is_on_sale"  value="1">
						<label for="sex-1">是</label>
					</div>
					<div class="radio-box">
						<input type="radio" {$goodsOne['is_on_sale']=="0"?'checked':''} name="is_on_sale" value="0"  >
						<label for="sex-2">否</label>
					</div>
				</div>
			</div>
			
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">排序：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:250px;"   class="input-text"  value="{$goodsOne['sort_num']}" name="sort_num">
				</div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>seo优化关键字：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="text" value="{$goodsOne['seo_keyword']}" class="input-text"  name="seo_keyword">
				</div>
			</div>

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">seo优化描述：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<textarea name="seo_description" cols="" rows="" class="textarea"  placeholder="说点什么...100个字符以内" dragonfly="true" onKeyUp="$.Huitextarealength(this,100)">{$goodsOne['seo_description']}</textarea>
					<p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>
				</div>
			</div>

			<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">详细内容：</label>
				<div class="formControls col-xs-8 col-sm-9"> 
					<script id="editor" type="text/plain" name="goods_desc" style="width:100%;height:400px;">{$goodsOne['goods_desc']}</script> 
				</div>
			</div>
		</div>

		<div id="mix-table" style="display:none">
			<div class="row cl" id="attr">
				<label class="form-label col-xs-4 col-sm-2">商品类型：</label>
				<div class="formControls col-xs-8 col-sm-9"> 
					<span class="select-box" style="width:150px;">
					<select class="select" name="type_id" size="1">
						<option value="">选择类型</option>
						<foreach name="typeAll" item="val">
						<option value="{$val['id']}"   {$goodsOne['type_id']==$val['id']?"selected=true":''}>{$val['type_name']}</option>
						</foreach>
					</select>
					</span>
				 </div>
			</div>
			<div class="row cl">
				<div id="goods_attr">
					{$goodsAttrHtml}
				</div>
			</div>
			
		</div>

		<div id="level-table" style="display:none">
			<foreach name="memberLevelAll" item="val">
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-3">{$val['level_name']}：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="number" style="width:300px;" value="{$val['price']}" class="input-text"  name="member_price[{$val['id']}]">
				</div>
			</div>
			</foreach>
		</div>

		<div  id="pic-table" style="display:none">
			<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">选择图片：</label>
			<div class="formControls col-xs-8 col-sm-9">
			<div class="uploader-thum-container">
			<div id="fileList" class="uploader-list"></div>
			<button id="btn-star" class="btn btn-default btn-uploadstar radius ml-10"><input type="file" name="pics[ ]" multiple='multiple'></button>
			</div>
			</div>
			<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">选择图片：</label>
			<div class="formControls col-xs-8 col-sm-9">
			<ul id="pics_ul" style="float:left">
				<foreach name="goodsPicsList " item="val">
					<li>
					<input type="button" class="del_img" id="{$val['id']}" value="删除"><br>
					<img width="50"src="__ROOT__/Uploads/{$val['pic']}" alt="">
					</li>
				</foreach>
			</ul>
			</div>
			</div>
		</div>

			
		</div>
	</div>
	<div class="row cl">
		<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
			<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
		</div>
	</div>
	</form>
</article>


<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__PUBLIC__/Admin/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/lib/jquery.validation/1.14.0/messages_zh.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/lib/ueditor/1.4.3/ueditor.all.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">

function charea(a) {
	var spans = ['general','mix','level','pic'];
	for(i=0;i<spans.length;i++) {
		var o = document.getElementById(spans[i]+'-tab');
		var tb = document.getElementById(spans[i]+'-table');
		o.className = o.id==a+'-tab'?'tab-front':'tab-back';
		tb.style.display = tb.id==a+'-table'?'block':'none';
	}
}


$('#promote').click(function(){
	if($(this).attr('checked')==undefined){
		$("input[name='promote_price']").removeAttr("disabled");
		$("input[name='promote_start_time']").removeAttr("disabled");
		$("input[name='promote_end_time']").removeAttr("disabled");
		$(this).attr('checked',true);
	}else{
		$("input[name='promote_price']").attr("disabled",'disabled');
		$("input[name='promote_start_time']").attr("disabled",'disabled');
		$("input[name='promote_end_time']").attr("disabled",'disabled');
		$(this).removeAttr('checked');
	}
});



if($('#promote').attr('checked')=='checked'){
	$("input[name='promote_price']").removeAttr("disabled");
	$("input[name='promote_start_time']").removeAttr("disabled");
	$("input[name='promote_end_time']").removeAttr("disabled");
}else{
	$("input[name='promote_price']").val("");
	$("input[name='promote_start_time']").val("");
	$("input[name='promote_end_time']").val("");
}


 var attr_nav = $('#goods_attr').html();



$('select[name="type_id"]').change(function(){
	var type_id = $(this).val();
	var new_selected = $(this).children('option:selected').html();
	var old_selected = $(this).find('option[selected="true"]').html();
	if(new_selected==old_selected){
		$('#goods_attr').html(attr_nav);
	}else  if(type_id!=""){
	 	$.ajax({
			type:'GET',
			url:"{:U('ajaxGetAttr','',false)}/type_id/"+type_id,
			dataType:'json',
			success:function(data){
			            	if(data){
			               	 var html=""
					$(data).each(function(key,val){
						      html += "<div class='row cl' ><label class='form-label col-xs-4 col-sm-2'>";
						        if(val.attr_type==1)
						      	html += "<a onclick='addnew(this)' javascript='void(0)'>[+]</a>";
						      html += val.attr_name + "：</label>";
						    
						      if(val.attr_option_values == "")
						              html += "<div class='formControls col-xs-8 col-sm-9'><input type='text' class='input-text' style='width:250px' name='attr_id[][" + val['id'] + "]' />";
						      else{
						              var _attr = val.attr_option_values.split(',');
						              html += "&nbsp;&nbsp;&nbsp;<span class='select-box' style='width:250px;''><select class='select' size='1' name='attr_id[][" + val['id'] + "]'>";
						              html += "<option value=''>请选择</option> ";
						              for(var i=0;i<_attr.length;i++){
						                 html += "<option value="+_attr[i]+">"+_attr[i]+"</option> ";
						              }
						              html += "</select></span>";
						      }
						      html += "</div></div>";
					});	
			             	$('#goods_attr').html(html);
			            	}
                        		}
		});
	 }else
		$('#goods_attr').html('');
});


function addnew(a){
              var p = $(a).parent().parent();
              if($(a).html()=="[+]"){
                    var newP = p.clone();
                    var attr_input = newP.find('input');

                    var oldName = attr_input .attr('name');
                    if(oldName){
	                    var oldName = oldName.replace('old_','');
	                    var newName = oldName.slice(0,10);
	                    var attr_id = attr_input.attr('attr_id');
	                    var newName = newName+'[ ]['+attr_id+']';
	                    attr_input.attr("name",newName);
	            }

                    var attr_select = newP.find('select');
                     var oldName = attr_select.attr('name');

                    if( oldName ){
	                var oldName = oldName.replace('old_','');
	                var newName = oldName.slice(0,7);
	                var attr_id = attr_select.attr('attr_id');
	                var newName = newName+'[ ]['+attr_id+']';
	                attr_select.attr("name",newName);
	                newP.find("a").html("[-]");
	                p.after(newP);
                    }
              }else{
              	if( !(p.find('select').attr('name').indexOf('old_')== -1) ){
	                    var id = $(a).attr('id');
	                    if(confirm("确定要删除该属性吗？")){
	                          $.ajax({
	                                type:'GET',
	                                url:"{:U('ajaxDelAttr','',false)}/id/"+id,
	                                dataType:'json',
	                                success:function(data){
	                                       if(data==1)
	                                              p.remove();
	                                }
	                          });
	               }
                     }else{
               	p.remove();
               }
             }
       }

$(function(){
	var ue = UE.getEditor('editor');
});


$('.del_img').click(function(){
var id = $(this).attr('id');
	$.ajax({
		type:'GET',
		url:"{:U('ajaxDelImg','',false)}/id/"+id,
		dataType:'json',
		success:function(data){
			if(data==1)
			$('input[id="'+id+'"]').parent().remove();
		}
	}) 
});


</script> 
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>
